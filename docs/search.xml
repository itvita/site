<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>AOP统数据库统一字段处理</title>
    <url>/20221122/AOP%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%9F%E4%B8%80%E5%AD%97%E6%AE%B5%E5%A4%84%E7%90%86/</url>
    <content><![CDATA[<blockquote>
<p>废话不多说，请看代码<br>示例代码为APO+mybatis</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itvita.norisk.company.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itvita.norisk.company.model.dto.CmpUserDto;</span><br><span class="line"><span class="keyword">import</span> com.itvita.norisk.company.util.SystemUtil;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanWrapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanWrapperImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Time</span>: 2021/5/27 11:16</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liu.q [916000612@qq.com]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@des</span>:  统一处理公共数据库字段</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlAopConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.itvita.norisk.company.mapper.*.insert(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">excudeAddService</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.itvita.norisk.company.mapper.*.updateById(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">excudeUpdateService</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;excudeAddService()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">addAround</span><span class="params">(ProceedingJoinPoint thisJoinPoint)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Object[] args = thisJoinPoint.getArgs();</span><br><span class="line">            <span class="comment">// myBatis只能传递一个参数</span></span><br><span class="line">            <span class="keyword">if</span> (args != <span class="literal">null</span> &amp;&amp; args.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">Object</span> <span class="variable">argument</span> <span class="operator">=</span> args[<span class="number">0</span>];</span><br><span class="line">                <span class="type">BeanWrapper</span> <span class="variable">beanWrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanWrapperImpl</span>(argument);</span><br><span class="line">                <span class="type">CmpUserDto</span> <span class="variable">cmpUserDto</span> <span class="operator">=</span> SystemUtil.getCmpUserDto();</span><br><span class="line">                beanWrapper.setPropertyValue(<span class="string">&quot;createdBy&quot;</span>, cmpUserDto.getId());</span><br><span class="line">                beanWrapper.setPropertyValue(<span class="string">&quot;createdName&quot;</span>, cmpUserDto.getNickName());</span><br><span class="line">                beanWrapper.setPropertyValue(<span class="string">&quot;createdTime&quot;</span>, LocalDateTime.now());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> thisJoinPoint.proceed(args);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;excudeUpdateService()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">UpdAround</span><span class="params">(ProceedingJoinPoint thisJoinPoint)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Object[] args = thisJoinPoint.getArgs();</span><br><span class="line">            <span class="comment">// myBatis只能传递一个参数</span></span><br><span class="line">            <span class="keyword">if</span> (args != <span class="literal">null</span> &amp;&amp; args.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">Object</span> <span class="variable">argument</span> <span class="operator">=</span> args[<span class="number">0</span>];</span><br><span class="line">                <span class="type">BeanWrapper</span> <span class="variable">beanWrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanWrapperImpl</span>(argument);</span><br><span class="line">                <span class="type">CmpUserDto</span> <span class="variable">cmpUserDto</span> <span class="operator">=</span> SystemUtil.getCmpUserDto();</span><br><span class="line">                beanWrapper.setPropertyValue(<span class="string">&quot;updatedBy&quot;</span>, cmpUserDto.getId());</span><br><span class="line">                beanWrapper.setPropertyValue(<span class="string">&quot;updatedName&quot;</span>, cmpUserDto.getNickName());</span><br><span class="line">                beanWrapper.setPropertyValue(<span class="string">&quot;updatedTime&quot;</span>, LocalDateTime.now());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> thisJoinPoint.proceed(args);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>springboot</category>
      </categories>
      <tags>
        <tag>aop</tag>
      </tags>
  </entry>
  <entry>
    <title>mac配置多jdk随意切换</title>
    <url>/20221121/mac%E9%85%8D%E7%BD%AE%E5%A4%9Ajdk%E9%9A%8F%E6%84%8F%E5%88%87%E6%8D%A2/</url>
    <content><![CDATA[<h1 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h1><p><a href="https://support.apple.com/kb/DL1572?locale=zh_CN">JDK6</a><br><a href="">JDK7</a><br><a href="">JDK8</a></p>
<h1 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h1><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">open .bash_profile</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/local/apache-tomcat-7.0.79/bin</span><br><span class="line"><span class="built_in">export</span> JAVA_6_HOME=/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Home</span><br><span class="line"><span class="built_in">export</span> JAVA_7_HOME=/Library/Java/JavaVirtualMachines/jdk1.7.0_79.jdk/Contents/Home</span><br><span class="line"><span class="built_in">export</span> JAVA_8_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_131.jdk/Contents/Home</span><br></pre></td></tr></table></figure>

<h1 id="设置默认的jdk版本"><a href="#设置默认的jdk版本" class="headerlink" title="设置默认的jdk版本"></a>设置默认的jdk版本</h1><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=<span class="variable">$JAVA_8_HOME</span> </span><br></pre></td></tr></table></figure>

<h1 id="设置alias-用于切换"><a href="#设置alias-用于切换" class="headerlink" title="设置alias 用于切换"></a>设置alias 用于切换</h1><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">alias</span> jdk8=<span class="string">&#x27;export JAVA_HOME=$JAVA_8_HOME&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> jdk7=<span class="string">&#x27;export JAVA_HOME=$JAVA_7_HOME&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> jdk6=<span class="string">&#x27;export JAVA_HOME=$JAVA_6_HOME&#x27;</span></span><br></pre></td></tr></table></figure>

<h1 id="保存退出后刷新配置"><a href="#保存退出后刷新配置" class="headerlink" title="保存退出后刷新配置"></a>保存退出后刷新配置</h1><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> .bash_profile</span><br></pre></td></tr></table></figure>

<h1 id="切换jdk"><a href="#切换jdk" class="headerlink" title="切换jdk"></a>切换jdk</h1><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">命令行输入jdk6，再输入java -version 查看当前版本即可实现动态切换，jdk7，jdk8同样。</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>mac</tag>
        <tag>jdk</tag>
      </tags>
  </entry>
  <entry>
    <title>centos安装gitblit</title>
    <url>/20221123/centos%E5%AE%89%E8%A3%85gitblit/</url>
    <content><![CDATA[<h1 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h1><p><a href="http://gitblit.github.io/gitblit/">http://gitblit.github.io/gitblit/</a></p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><ol>
<li>上传到centos &#x2F;opt下，解压为 gitblit</li>
<li>进入gitblit&#x2F;data 修改默认配置文件<blockquote>
<p>default.properties</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.httpPort = 8088  #访问端口 </span><br><span class="line">server.httpsPort = 0 (#0表示禁用此https端口，根据个人需求设置)</span><br><span class="line">server.httpBindInterface = 主机IP (#默认为空，也可写成主机IP，为空时则可以通过远程访问gitblit，建议为空)</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./gitblit.sh</span><br><span class="line"></span><br><span class="line">后台启动：</span><br><span class="line">nohup ./gitblit.sh &amp;</span><br></pre></td></tr></table></figure>

<h1 id="配置nginx访问"><a href="#配置nginx访问" class="headerlink" title="配置nginx访问"></a>配置nginx访问</h1><p>1.nginx转发配置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#gitblit</span><br><span class="line">server &#123;</span><br><span class="line"> listen 80;</span><br><span class="line"> server_name  域名;</span><br><span class="line">	</span><br><span class="line"> location / &#123;</span><br><span class="line">     proxy_pass http://localhost:8088/;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>2.转码问题 （无法加载目录）</p>
<blockquote>
<p>default.properties</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">web.forwardSlashCharacter = !</span><br></pre></td></tr></table></figure>
<p>3.仓库地址问题</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">web.canonicalUrl = http://域名</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>git</tag>
        <tag>CentOs</tag>
      </tags>
  </entry>
  <entry>
    <title>centos安装mysql</title>
    <url>/20221127/centos%E5%AE%89%E8%A3%85mysql/</url>
    <content><![CDATA[<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p><strong>1、检查Linux是否安装了mariadb数据库，mariadb数据库是mysql的分支</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行命令：</span></span><br><span class="line">yum list installed | grep mariadb </span><br></pre></td></tr></table></figure>

<p><strong>2、如果Linux中安装了mariadb数据库，先卸载掉，因为CentOS 7.6 内部集成了mariadb，而安装mysql的话会和mariadb的文件冲突，所以需要先卸载掉mariadb</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行命令：</span></span><br><span class="line">yum -y remove mariadb-libs.x86_64</span><br></pre></td></tr></table></figure>

<p><strong>3、下载mysql安装包</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行命令：</span></span><br><span class="line">wget https://cdn.mysql.com//Downloads/MySQL-5.7/mysql-5.7.32-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">然后移动到/usr/local下</span></span><br><span class="line">mv mysql-5.7.32-linux-glibc2.12-x86_64.tar.gz /usr/local</span><br></pre></td></tr></table></figure>

<p><strong>4、解压</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">解压tar包：</span></span><br><span class="line">tar -xvf mysql-5.7.32-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">解压下载下来的mysql软件压缩包，执行命令：</span></span><br><span class="line">tar -zxvf mysql-5.7.32-linux-glibc2.12-x86_64.tar.gz</span><br></pre></td></tr></table></figure>

<p><strong>5、更名</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">解压下载下来的mysql软件压缩包，执行命令：</span></span><br><span class="line">mv mysql-5.7.32-linux-glibc2.12-x86_64 mysql</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">然后进入目录</span></span><br><span class="line">cd mysql</span><br></pre></td></tr></table></figure>

<p><strong>6、在mysql-5.7.32文件夹目录下创建一个&#x2F;data&#x2F;3306文件夹</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行命令：</span></span><br><span class="line">mkdir -vp ./data </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">（v表示创建新目录都显示信息，p表示递归创建）</span></span><br></pre></td></tr></table></figure>

<p><strong>7、添加mysql用户及用户组</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行命令：</span></span><br><span class="line">groupadd mysql</span><br><span class="line"></span><br><span class="line">useradd mysql -g mysql </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">（-g: 是指定用户所在组）</span></span><br></pre></td></tr></table></figure>

<p><strong>8、切换到.&#x2F;bin目录下执行：</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./mysqld --initialize-insecure --user=mysql --datadir=/usr/local/mysql/data --basedir=/usr/local/mysql</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">（--initialize-insecure标识不设置密码， root@localhost is created with an empty password ! Please consider switching off the --initialize-insecure option.）</span></span><br></pre></td></tr></table></figure>

<p><strong>9、在mysql&#x2F;bin目录下</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行命令：</span></span><br><span class="line">./mysql_ssl_rsa_setup --datadir=/usr/local/mysql/data （表示安全连接访问，生成RSA私钥）</span><br></pre></td></tr></table></figure>

<p><strong>10、更改mysql-5.7.32整个文件夹目录权限所属</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行命令：</span></span><br><span class="line">chown -R mysql:mysql /usr/local/mysql （-R表示迭代递归）</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">chmod</span>：文件/目录权限设置命令</span></span><br></pre></td></tr></table></figure>

<p><strong>11、在&#x2F;etc 目录下创建my.cnf文件</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">[client]</span><br><span class="line">port = 3306</span><br><span class="line">socket = /opt/mysql5.7.32/data/3306/mysql.sock</span><br><span class="line">default-character-set=utf8</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">port = 3306</span><br><span class="line">socket = /opt/mysql5.7.32/data/3306/mysql.sock</span><br><span class="line">datadir = /opt/mysql5.7.32/data/3306</span><br><span class="line">log-error = /opt/mysql5.7.32/data/3306/error.log</span><br><span class="line">pid-file = /opt/mysql5.7.32/data/3306/mysql.pid</span><br><span class="line">lower_case_table_names=1</span><br><span class="line">character-set-server=utf8mb4</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">skip-grant-tables</span></span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8mb4</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>至此MySQL安装完成;</p>
<p><strong>12、启动MySQL服务</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在mysql-5.7.24/bin目录下执行命令：</span></span><br><span class="line">./mysqld_safe --defaults-file=/etc/my.cnf</span><br></pre></td></tr></table></figure>

<p><strong>13、修改密码</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">登录进入mysql，在mysql-5.7.32/bin目录下执行命令：</span></span><br><span class="line">./mysql -uroot -p -P3306 -h127.0.0.1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改mysql的密码，执行：</span></span><br><span class="line">alter user &#x27;root&#x27;@&#x27;localhost&#x27; identified by &#x27;123456&#x27;;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">然后刷新</span></span><br><span class="line">flush privileges; </span><br></pre></td></tr></table></figure>

<p><strong>14授权远程访问</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">登录进入mysql执行命令：（这样远程客户端才能访问）</span></span><br><span class="line">grant all privileges on *.* to root@&#x27;%&#x27; identified by &#x27;123456&#x27;;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">其中*.* 的第一个*表示所有数据库名，第二个*表示所有的数据库表；</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">root@<span class="string">&#x27;%&#x27;</span> 中的root表示用户名，%表示ip地址，%也可以指定具体的ip地址，比如root@localhost，root@xx.xx.xx.xx</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">然后刷新</span></span><br><span class="line">flush privileges; </span><br></pre></td></tr></table></figure>

<p><strong>15、关闭MySQL服务</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入mysql-5.7.32/bin目录下执行命令：</span></span><br><span class="line">./mysqladmin -uroot -p -P3306 -h127.0.0.1 shutdown</span><br></pre></td></tr></table></figure>

<h1 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">vim /etc/profile -- 所有用户生效</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">vim ~/.bash_profile --当前用户生效</span></span><br><span class="line">export MYSQL_HOME=&quot;/usr/local/mysql&quot;</span><br><span class="line">export PATH=&quot;$PATH:$MYSQL_HOME/bin&quot;</span><br></pre></td></tr></table></figure>

<h1 id="刷新环境变量"><a href="#刷新环境变量" class="headerlink" title="刷新环境变量"></a>刷新环境变量</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">source  /etc/profile</span><br></pre></td></tr></table></figure>

<h1 id="设置到开机启动"><a href="#设置到开机启动" class="headerlink" title="设置到开机启动"></a>设置到开机启动</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld  </span><br><span class="line"></span><br><span class="line">cp //usr/local/mysql/support-files/mysql.server /etc/rc.d/init.d/mysql</span><br><span class="line"></span><br><span class="line">chmod 700 /etc/init.d/mysql   </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加入到系统服务命令</span></span><br><span class="line">chkconfig --add mysqld    </span><br><span class="line"></span><br><span class="line">chkconfig --level 2345 mysqld on </span><br></pre></td></tr></table></figure>

<h1 id="其他命令"><a href="#其他命令" class="headerlink" title="其他命令"></a>其他命令</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动</span></span><br><span class="line"> service mysql start</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">停止</span></span><br><span class="line"> service mysql stop</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重启</span></span><br><span class="line"> service mysql restart</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>centos安装nginx</title>
    <url>/20221127/centos%E5%AE%89%E8%A3%85nginx/</url>
    <content><![CDATA[<h1 id="下载地址"><a href="#下载地址" class="headerlink" title="下载地址"></a>下载地址</h1><p><a href="http://nginx.org/en/download.html">nginx官网</a></p>
<h1 id="命令下载"><a href="#命令下载" class="headerlink" title="命令下载"></a>命令下载</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.18.0.tar.gz</span><br></pre></td></tr></table></figure>

<h1 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install gcc gcc-c++ pcre* openssl* gd-devel* zlib-devel pcre-devel</span><br></pre></td></tr></table></figure>

<h1 id="解压并进入目录"><a href="#解压并进入目录" class="headerlink" title="解压并进入目录"></a>解压并进入目录</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar –zxvf nginx-1.18.0.tar.gz</span><br><span class="line">cd nginx-1.18.0</span><br></pre></td></tr></table></figure>

<h1 id="创建nginx用户"><a href="#创建nginx用户" class="headerlink" title="创建nginx用户"></a>创建nginx用户</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">useradd -M -s /sbin/nologin nginx</span><br></pre></td></tr></table></figure>

<h1 id="配置编译参数"><a href="#配置编译参数" class="headerlink" title="配置编译参数"></a>配置编译参数</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./configure --prefix=/opt/nginx --with-http_stub_status_module --with-http_ssl_module --with-http_realip_module --with-http_flv_module --with-http_mp4_module --with-http_gzip_static_module --with-stream --with-stream_ssl_module #./configure –help</span><br></pre></td></tr></table></figure>

<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<h1 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /opt/nginx/sbin</span><br><span class="line">./nginx</span><br></pre></td></tr></table></figure>

<h1 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">刷新配置</span><br><span class="line">./nginx -s reload</span><br><span class="line">停止</span><br><span class="line">./nginx -s stop</span><br></pre></td></tr></table></figure>

<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><h2 id="腾讯云证书https的基本配置"><a href="#腾讯云证书https的基本配置" class="headerlink" title="腾讯云证书https的基本配置"></a>腾讯云证书https的基本配置</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">upstream myproject &#123;</span><br><span class="line">    server 127.0.0.1:8000 weight=3; //weight 权重，数字越大轮到的几率越大</span><br><span class="line">    server 127.0.0.1:8001;</span><br><span class="line">    server 127.0.0.1:8002;</span><br><span class="line">    server 127.0.0.1:8003;</span><br><span class="line"> &#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">myMiniProgram</span></span><br><span class="line">server &#123;  </span><br><span class="line">	listen 80;  </span><br><span class="line">	server_name xx.com;  </span><br><span class="line">	rewrite ^(.*)$  https://$host$1 permanent;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">SSL 访问端口号为 443</span></span><br><span class="line">  listen 443 ssl; </span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">填写绑定证书的域名</span></span><br><span class="line">  server_name cloud.tencent.com; </span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">证书文件名称</span></span><br><span class="line">  ssl_certificate 1_cloud.tencent.com_bundle.crt; </span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">私钥文件名称</span></span><br><span class="line">  ssl_certificate_key 2_cloud.tencent.com.key; </span><br><span class="line">  ssl_session_timeout 5m;</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">请按照以下协议配置</span></span><br><span class="line">  ssl_protocols TLSv1 TLSv1.1 TLSv1.2; </span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">请按照以下套件配置，配置加密套件，写法遵循 openssl 标准。</span></span><br><span class="line">  ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; </span><br><span class="line">  ssl_prefer_server_ciphers on;</span><br><span class="line"><span class="meta prompt_">	</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">代理转发</span></span><br><span class="line">	location / &#123;</span><br><span class="line">	    #自定义请求头内容</span><br><span class="line">		proxy_set_header X-Forwarded-Scheme  https;</span><br><span class="line">		proxy_set_header X-Forwarded-port  443;</span><br><span class="line">		client_max_body_size 1000m; </span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">设置主机头和客户端真实地址，以便服务器获取客户端真实IP</span></span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">		proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">        #禁用缓存</span><br><span class="line">        proxy_buffering off;</span><br><span class="line">        #反向代理的地址</span><br><span class="line">        proxy_pass http://localhost:7878; </span><br><span class="line">        # proxy_pass http://myproject; #用这行代替上面，实现负载均衡</span><br><span class="line">        #启用支持websocket连接</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">静态代理</span></span><br><span class="line">	location /admin &#123;</span><br><span class="line">	   alias /usr/local/mymini/cpp-web;</span><br><span class="line">       index login.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="srpingboot-request-get…uri-还是http怎么办？"><a href="#srpingboot-request-get…uri-还是http怎么办？" class="headerlink" title="srpingboot request.get…uri ,还是http怎么办？"></a>srpingboot request.get…uri ,还是http怎么办？</h1><blockquote>
<p>配置tomcat</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.tomcat.protocol-header=X-Forwarded-Proto # ssl forward headers</span><br><span class="line">server.tomcat.remote-ip-header=X-Forwarded-For</span><br></pre></td></tr></table></figure>

<h4 id="代理tcp协议链接mysql"><a href="#代理tcp协议链接mysql" class="headerlink" title="代理tcp协议链接mysql"></a>代理tcp协议链接mysql</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">stream &#123;</span><br><span class="line">    upstream cloudsocket &#123;</span><br><span class="line">       hash $remote_addr consistent;</span><br><span class="line">      # $binary_remote_addr;</span><br><span class="line">       server 127.0.0.1:3306 weight=5 max_fails=3 fail_timeout=30s;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">       listen 3306;#数据库服务器监听端口</span><br><span class="line">       proxy_connect_timeout 10s;</span><br><span class="line">       proxy_timeout 300s;#设置客户端和代理服务之间的超时时间，如果5分钟内没操作将自动断开。</span><br><span class="line">       proxy_pass cloudsocket;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>nginx</tag>
      </tags>
  </entry>
</search>
